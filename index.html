<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜„ì¥ ì¸¡ì • ë°ì´í„° ì…ë ¥</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-bottom: 50px; }
        .container { max-width: 500px; }
        .card { margin-top: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .history-item { font-size: 0.9rem; border-bottom: 1px solid #ddd; padding: 10px 0; }
    </style>
</head>
<body>
<div class="container">
    <div class="card p-4">
        <h4 class="mb-3">ğŸ“ ì¸¡ì • ë°ì´í„° ì…ë ¥</h4>
        <form id="measureForm">
            <input type="hidden" id="rowId">
            <div class="mb-2"><input type="text" id="í˜„ì¥" class="form-control" placeholder="í˜„ì¥ëª…" required></div>
            <div class="mb-2"><input type="text" id="êµ¬ì—­" class="form-control" placeholder="êµ¬ì—­"></div>
            <div class="mb-2"><input type="text" id="ë„ë©´ë²ˆí˜¸" class="form-control" placeholder="ë„ë©´ë²ˆí˜¸"></div>
            <div class="mb-2"><input type="text" id="í•­ëª©" class="form-control" placeholder="í•­ëª© (ì˜ˆ: ë³´, ê¸°ë‘¥)"></div>
            <div class="row g-2 mb-2">
                <div class="col"><input type="number" id="x" class="form-control" placeholder="X (mm)"></div>
                <div class="col"><input type="number" id="y" class="form-control" placeholder="Y (mm)"></div>
                <div class="col"><input type="number" id="z" class="form-control" placeholder="Z (mm)"></div>
            </div>
            <div class="mb-2"><input type="text" id="ë‹¨ìœ„" class="form-control" value="mm" readonly></div>
            <div class="mb-3"><textarea id="ë©”ëª¨" class="form-control" placeholder="ë©”ëª¨"></textarea></div>
            <button type="submit" class="btn btn-primary w-100 py-3">ë°ì´í„° ì €ì¥í•˜ê¸°</button>
        </form>
    </div>

    <div class="mt-4">
        <h5>ìµœê·¼ ì…ë ¥ ë‚´ì—­</h5>
        <div id="historyList" class="bg-white p-3 rounded shadow-sm">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>
</div>

<script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzKNheqQ2GD-io-EfS-qzw-B616pqtdECC_KBBTPeOVBBZwN4kfZfpEW1tOqUiYShHWrg/exec';
    const deviceId = localStorage.getItem('deviceId') || 'DEV-' + Math.random().toString(36).substr(2, 9);
    if(!localStorage.getItem('deviceId')) localStorage.setItem('deviceId', deviceId);

    // ë°ì´í„° ì €ì¥
    document.getElementById('measureForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
            rowId: document.getElementById('rowId').value,
            í˜„ì¥: document.getElementById('í˜„ì¥').value,
            êµ¬ì—­: document.getElementById('êµ¬ì—­').value,
            ë„ë©´ë²ˆí˜¸: document.getElementById('ë„ë©´ë²ˆí˜¸').value,
            í•­ëª©: document.getElementById('í•­ëª©').value,
            x: document.getElementById('x').value,
            y: document.getElementById('y').value,
            z: document.getElementById('z').value,
            ë‹¨ìœ„: document.getElementById('ë‹¨ìœ„').value,
            ë©”ëª¨: document.getElementById('ë©”ëª¨').value,
            deviceId: deviceId
        };

        if(!data.x && !data.y && !data.z) return alert("X, Y, Z ì¤‘ í•˜ë‚˜ëŠ” ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");

        const btn = e.target.querySelector('button');
        btn.disabled = true; btn.innerText = "ì €ì¥ ì¤‘...";

        await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify(data)
        });

        alert("ì €ì¥ ì™„ë£Œ!");
        location.reload();
    });

    // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadData() {
        const res = await fetch(API_URL);
        const list = await res.json();
        const container = document.getElementById('historyList');
        container.innerHTML = '';
        
        list.slice(0, 10).forEach(item => {
            const div = document.createElement('div');
            div.className = 'history-item';
            div.innerHTML = `
                <strong>${item.í•­ëª© || 'ë¯¸ì§€ì •'}</strong> (${item.x || 0}*${item.y || 0}*${item.z || 0})<br>
                <small class="text-muted">${item.í˜„ì¥} - ${item.êµ¬ì—­} | ${item.deviceId.substring(0,8)}</small>
            `;
            container.appendChild(div);
        });
    }

    loadData();
</script>
</body>
</html>
